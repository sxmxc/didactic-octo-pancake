meta:
  version: 1
  last_updated: 2025-11-19
  notes: >-
    Structured backlog with priorities, blockers, and subtasks so agents can
    quickly gauge sequencing constraints.
areas:
  - id: core_mechanics
    title: Core mechanics
    tasks:
      - id: core.menu_bar_unification
        title: Unified menu bar + drawer profiles
        priority: critical
        status: done
        owner: unassigned
        problem: >-
          The shared `MenuBar` + drawer system now drives the world-view HUD, but focus view
          still relies on the legacy `focus_view_menu.tscn`, and documentation hasn't caught up.
          We need to finish migrating focus view to the new profile workflow and capture the
          architecture so future buttons/drawers are easy to add.
        entrypoints:
          - scenes/ui/ui.tscn (SubViewport hierarchy + HUDMenuBar owner)
          - scenes/ui/menu_bar.tscn / scenes/ui/menu_bar.gd
          - scenes/ui/drawers/menu_drawer.gd (animation/input handling)
          - scenes/ui/drawers/*_drawer.tscn|gd (creature, eggs, build, food, details)
          - scenes/ui/focus_view_menu.tscn (legacy to retire after migration)
          - README.md
          - TODO.yaml
        blockers: []
        subtasks:
          - description: ✅ Author `scenes/ui/menu_bar.tscn` with shared button row, ButtonGroup toggles,
              drawer host, and save/zoom signals (world profile live).
          - description: ✅ Create drawer scenes (creature list, egg catalog, build shop, food bag,
              creature details) extending `MenuDrawer`, hooked under the SubViewport.
          - description: ✅ Implement profile data/API so the bar swaps button sets; world profile is
              wired, focus profile still needs migration onto HUDMenuBar.
          - description: ✅ Wire buttons to animated drawers (single-open enforcement, icon tweens,
              build drag auto-close) and remove redundant world menu logic.
          - description: ✅ Document the new HUD architecture + usage in README/TODO once focus migration
              is complete.
          - description: ✅ Migrate focus view to the shared `MenuBar` profile (zoom + creature details
              buttons, drawer content) and delete the old `focus_view_menu` scene/scripts.
        definition_of_done: >-
          A single menu_bar scene drives both world/focus HUDs, buttons toggle drawers cleanly,
          save appears only in world view, zoom only in focus view, documentation covers the flow,
          and the legacy menus are removed.
      - id: core.behavior_tree_action_expansion
        title: Behavior tree action expansion
        priority: medium
        status: done
        owner: unassigned
        problem: >-
          The current creature behavior tree only contains a handful of basic actions (idle,
          sleep, eat, wander), so creatures never perform richer interactions like grooming,
          social play, nest maintenance, or curiosity-driven exploration.
        entrypoints:
          - creature_ai/actions/* (BeeHave action scripts)
          - creature_ai/conditions/* (BeeHave condition scripts)
          - scenes/creature/Creature.gd (behavior tree assembly + blackboard state)
          - scenes/world.gd (world events that should trigger new actions)
        blockers: []
        subtasks:
          - description: ✅ Audited the Sleep/Eat/Wander-only BeeHave tree and defined grooming + nest
              decay stats so the missing scenarios and blackboard data were captured in README.md.
          - description: ✅ Added `NeedsGroomingCondition`/`GroomSelfAction` and `IsNestDirtyCondition`/
              `CleanNestAction` so creatures perform self-care before falling back to roaming.
          - description: ✅ Synced the new stats/blackboard values via `scenes/creature/Creature.gd` with
              exported tuning knobs for grooming relief and nest cleanliness recovery.
          - description: ✅ Documented action priorities, triggers, and side effects in README.md plus
              this TODO entry so future designers can extend the tree confidently.
        definition_of_done: >-
          Creatures regularly demonstrate the new actions in sandbox playtests, blackboard data is
          clearly defined, and documentation lists available actions plus how to extend them.
      - id: core.egg_inventory_weighted_spawns
        title: Egg inventory + weighted hatching
        priority: medium
        status: done
        owner: unassigned
        problem: >-
          Eggs currently spawn randomly without player agency, but design now calls for
          pack-like drops (1/3/5 bundles) that players earn via daily/periodic rewards
          or purchase with soft currency, then consume to spawn new creatures using
          weighted RNG per egg tier.
        entrypoints:
          - autoload/data.gd (inventory + currency definitions)
          - autoload/game.gd (reward cadence + egg consumption flow)
          - scenes/world.gd (spawn loop integration)
          - scenes/ui/* (reward/pack purchase UX)
          - resources/eggs/egg_inventory.gd (persisted pack/token data)
          - README.md / TODO.yaml (document pack naming + acquisition rules)
        blockers: []
        subtasks:
          - description: ✅ Introduced `resources/eggs/egg_inventory.gd` and rewired `Player`
              to serialize pack counts, claim timers, and tiered egg tokens instead of the
              old free-form array payload.
          - description: ✅ Defined Daily Meadow Drop, Brood Bundle, and Nursery Crate packs
              (counts, tiers, cooldowns, gold costs) plus Meadow/Tidepool/Phantom tier metadata
              directly in `autoload/data.gd`, anchored to the new `egg_tier`/`hatch_weight`
              exports on every baby species resource.
          - description: ✅ Updated `autoload/game.gd`/`scenes/world.gd` so daily rewards are
              delivered via `Game.sync_egg_rewards()`, new creatures only spawn by
              consuming tokens, and failed spawns automatically restore the egg.
          - description: ✅ Rebuilt `scenes/ui/drawers/egg_catalog_drawer.*` into the live
              pack/inventory drawer (claim, purchase, open, hatch odds) so designers no
              longer rely on the legacy world-view debug catalog.
          - description: ✅ Documented the pack economy in `README.md`/`TODO.yaml` so future
              contributors know how to extend packs, tiers, and UI hooks.
        definition_of_done: >-
          Eggs no longer appear for free; players earn/stock egg tokens via login rewards or
          purchases, inventory counts gate spawns, and weighted RNG tables determine hatch
          results with clear documentation.
      - id: core.stat_training_loops
        title: Stat training loops
        priority: high
        status: todo
        owner: unassigned
        problem: >-
          Creatures can lose hunger/energy over time but have no way to raise
          strength, intelligence, or other stats.
        entrypoints:
          - scenes/world.gd (world tick + event wiring)
          - scenes/creature/Creature.gd (stat container + behavior tree integration)
          - buildables/* (training stations)
          - autoload/eventbus.gd (signals)
          - resources/stats/creature_stats.gd
        blockers:
          - sim.training_payoff_model
        subtasks:
          - description: Author at least one Gym Pod/Study Desk buildable and register it in autoload/data.gd.
          - description: Extend idle AI so creatures can claim nearby training stations and emit "training" signals.
          - description: Increment stats during training sessions while draining hunger/energy on the world tick.
          - description: Broadcast progress through Eventbus so UI panels can reflect multiple concurrent trainings.
        definition_of_done: >-
          Stats visibly increase after training, UI reflects progress, and the system
          works for any number of creatures.
      - id: core.evolution_requirement_checks
        title: Evolution requirement checks
        priority: medium
        status: todo
        owner: unassigned
        problem: Species resources store requirement dictionaries, yet age-ups never evaluate them.
        entrypoints:
          - resources/creature/data/**/*.tres
          - scenes/creature/Creature.gd::_age_up
          - resources/stats/creature_stats.gd
        blockers: []
        subtasks:
          - description: Evaluate requirement dictionaries whenever a creature crosses an age threshold.
          - description: Select a valid teen/adult resource (support randomness or weighting) and swap sprites/stats.
          - description: Emit UI + notification signals detailing why a branch triggered.
        definition_of_done: >-
          Evolution outcomes reflect stat training and care history; requirements are
          easy to tweak per species.
      - id: core.care_mistake_tracking
        title: Care mistake tracking
        priority: medium
        status: done
        owner: unassigned
        problem: CreatureStats exposes care_mistakes but nothing increments it.
        entrypoints:
          - scenes/creature/Creature.gd
          - scenes/world.gd
          - autoload/eventbus.gd
        blockers: []
        subtasks:
          - description: ✅ Defined starvation/exhaustion/grooming/nest thresholds in `CARE_MISTAKE_RULES`
              inside `scenes/creature/creature.gd`, each with trigger and recovery ratios tuned for the
              10s world tick.
          - description: ✅ Increment care mistakes via `_evaluate_care_mistakes()` +
              `_record_care_mistake()`, emit `Eventbus.care_mistake_recorded` and
              `care_mistake_total_changed`, and sync the totals onto each creature's blackboard/UI signals.
          - description: ✅ Added a one in-game hour decay window (`CARE_MISTAKE_DECAY_HOURS`), documented the
              behavior in `README.md`, and surfaced totals so upcoming evolution checks can branch on them.
        definition_of_done: >-
          Care mistakes rise under neglect, reset/decay rules are documented, and
          evolution branches consume the value.
      - id: core.trait_system
        title: Trait system
        priority: medium
        status: done
        owner: unassigned
        problem: Creatures had no personality traits to differentiate behavior, yet design called for positive/negative traits that can be inherited, learned, and evolve over time (e.g., "glutton" worsening or improving).
        entrypoints:
          - scenes/creature/Creature.gd (trait container + lifecycle hooks)
          - resources/stats/creature_stats.gd (serialization + modifiers)
          - autoload/eventbus.gd (signals for trait changes)
          - README.md (document available traits and evolution rules)
        blockers: []
        subtasks:
          - description: ✅ Added `resources/traits/trait_state.gd` + `trait_catalog.gd` so trait ids, tiers, alignments, and modifiers live in data instead of ad-hoc dictionaries.
          - description: ✅ Stored trait arrays on `CreatureStats`, serialized them through `Creature._stats_to_dict()`/`_apply_stats_from_dict()`, and rolled one positive + one negative slot via `TraitCatalog.roll_random_state()` while exposing `add_trait`/`upgrade_trait`/`remove_trait`.
          - description: ✅ Fed trait multipliers into hunger ticks, energy drain/recovery, training XP/fatigue, and BeeHave grooming/nest actions, firing new `Eventbus.trait_*` signals plus notifications whenever traits change.
          - description: ✅ Surfaced live trait lists in `scenes/ui/drawers/creature_details_drawer.*` and documented the workflow/stats impact in `README.md`.
        definition_of_done: >-
          Creatures can spawn or learn traits, traits visibly impact simulation stats/behaviors, and documentation explains how traits evolve or flip alignment.
      - id: core.creature_types_and_nests
        title: Creature types + nest gating
        priority: medium
        status: todo
        owner: unassigned
        problem: >-
          Design now calls for land, flying, and water creatures with matching nest types, but the
          sim only exposes a single "BasicNest" buildable and creatures lack any elemental/type
          metadata, so nothing enforces habitat requirements.
        entrypoints:
          - resources/creature/species.gd (type metadata + serialization)
          - resources/creature/data/* (species resource definitions)
          - buildables/nests/* (new nest scenes + scripts per habitat)
          - autoload/data.gd (nest registries + build costs)
          - scenes/world.gd (spawning logic that assigns creatures to compatible nests)
          - README.md / TODO.yaml (document available types + nest rules)
        blockers: []
        subtasks:
          - description: Extend species resources with a `creature_type` enum (land, flying, water)
              and retrofit existing assets with the appropriate values.
          - description: Author distinct nest scenes/resources for water vs. land-capable creatures
              and register them in autoload/data.gd with clear build costs/requirements.
          - description: Update world spawning + nesting logic so water types can only occupy water
              nests while land and flying types share land nests, surfacing user feedback when no
              compatible nest exists.
          - description: Document the new type system, nest unlock rules, and cross-type behavior in
              README.md so future tasks can extend the taxonomy.
        definition_of_done: >-
          Every creature species declares a type, matching nests exist and are enforced at runtime,
          and documentation explains how habitats map to species plus how to add future types.
  - id: content_ux
    title: Content & UX
    tasks:
      - id: content.evolution_data_pass
        title: Evolution data pass
        priority: medium
        status: todo
        owner: unassigned
        problem: Only four baby species exist and one teen slot lacks a base form.
        entrypoints:
          - resources/creature/data/babies/*.tres
          - resources/creature/data/teens/*.tres
          - design docs
        blockers: []
        subtasks:
          - description: Flesh out evolution diagram nodes as .tres resources (names may be temporary).
          - description: Capture sprite references, requirement dictionaries, and metadata for each form.
          - description: Document relationships so future agents can implement them quickly.
        definition_of_done: >-
          Each teen/adult node in the diagram has a resource with documented
          requirements and owner sprites.
      - id: content.item_roster_audit
        title: Item roster audit
        priority: medium
        status: todo
        owner: unassigned
        problem: Starter buildables are debug conveniences and the long-term item list is undecided.
        entrypoints:
          - buildables/*
          - autoload/data.gd
          - design notes
        blockers: []
        subtasks:
          - description: Draft a proposed item progression (core habitat, specialty training gear, cosmetic clutter).
          - description: Note costs, unlock triggers, and desired effects for each tier.
          - description: Capture rationale inside README/TODO for early/mid/late-game availability.
        definition_of_done: >-
          README/TODO captures an ordered list of candidate items plus rationale for
          availability.
      - id: content.naming_and_theming
        title: Naming + theming review
        priority: low
        status: todo
        owner: unassigned
        problem: Species names are placeholders and may change with art direction.
        entrypoints:
          - resources/creature/data/**/*.tres
          - assets/design reference image
        blockers: []
        subtasks:
          - description: Propose naming conventions (e.g., elemental roots + suffix).
          - description: Outline how recolors or variants are labeled consistently.
          - description: Update design references if needed.
        definition_of_done: >-
          Documented naming guide plus a list of proposed replacements for existing
          species.
  - id: tooling
    title: Tooling
    tasks:
      - id: tooling.evolution_tree_asset_ingestion
        title: Evolution tree asset ingestion
        priority: medium
        status: todo
        owner: unassigned
        problem: The evolution-diagram image lives outside the repo.
        entrypoints:
          - assets/design/
          - README.md
        blockers: []
        subtasks:
          - description: Check the diagram into version control as both the editable source and exported PNG.
          - description: Reference the asset from README once available.
          - description: Document how to update/edit the source file.
        definition_of_done: >-
          Diagram sits in the repo, README links to it, and future contributors can
          edit the source.
  - id: maintenance
    title: Maintenance & cleanup
    tasks:
      - id: maintenance.remove_unused_drop_zone_canvas
        title: Remove unused drop zone canvas scripts
        priority: low
        status: todo
        owner: unassigned
        problem: >-
          The legacy `scenes/drop_zone_canvas.gd` script (and matching `.uid`) was replaced by
          `scenes/ui/drop_area.gd` but never deleted, so the orphan files now cause confusion about
          which drop target is authoritative.
        entrypoints:
          - scenes/drop_zone_canvas.gd
          - scenes/drop_zone_canvas.gd.uid
          - scenes/ui/drop_area.gd (replacement implementation)
          - scenes/world.tscn / scenes/world.gd
          - README.md / TODO.yaml
        blockers: []
        subtasks:
          - description: Confirm no scenes reference `drop_zone_canvas` (current drop logic hangs off `%DropArea`).
          - description: Delete the unused script + uid, removing any lingering load errors from the project cache.
          - description: Update documentation/TODO to point at `scenes/ui/drop_area.gd` as the drag/drop target.
        definition_of_done: >-
          The unused drop-zone canvas artifacts are gone, only `DropArea` handles build placement, and
          documentation/TODO references no longer mention the legacy script.
  - id: simulation_balance
    title: Simulation balance
    tasks:
      - id: sim.training_payoff_model
        title: Training payoff & upkeep model
        priority: high
        status: done
        owner: unassigned
        problem: Strength/intelligence/happiness never change after hatching, so training buildables will have no systemic impact.
        entrypoints:
          - resources/stats/creature_stats.gd
          - buildables/*
          - scenes/creature/Creature.gd
          - scenes/ui/*
        blockers: []
        subtasks:
          - description: ✅ Added baseline/cap + fractional progress fields to `resources/stats/creature_stats.gd` and wired the XP→stat conversion/decay math inside `scenes/creature/Creature.gd`.
          - description: ✅ Training sessions now drain extra hunger/energy, accumulate fatigue, and emit lifecycle signals (`autoload/eventbus.gd`, `Creature.begin_training_session()`).
          - description: ✅ README.md plus `scenes/ui/drawers/creature_details_drawer.*` document and surface the new status/fatigue readouts so evolution/combat systems can consume the same snapshot.
        definition_of_done: >-
          Training introduces clear tradeoffs (resource drain vs. stat growth), and
          documentation explains how to tune the reward curve and decay.
  - id: online_services
    title: Online services & auth
    tasks:
      - id: online.storefront_architecture_eval
        title: Storefront architecture decision
        priority: high
        status: done
        owner: unassigned
        problem: >-
          Decision locked: keep Talo for identity, analytics, and saves, while a new, multi-tenant,
          game-agnostic companion repo (`commerce-hub-suite`) owns storefront, dashboard, and Godot
          client logic. This repo will focus on integration touchpoints only.
        entrypoints:
          - README.md (documented options + recommendation + hybrid plan)
          - TODO.yaml (references to remaining storefront tasks)
          - docs/storefront_repo_prompt.md (prompt for spinning up the external repo)
        blockers: []
        subtasks:
          - description: ✅ Audited Talo extension points to confirm commerce logic is better hosted
              outside the core backend so we can keep upstream updates intact.
          - description: ✅ Spiked the companion service design and captured a bootstrap prompt for the
              `commerce-hub-suite` repo so future agents can create it consistently.
          - description: ✅ Documented fallback criteria and integration boundaries in README/TODO to keep
              future storefront tasks aligned with the hybrid approach.
        definition_of_done: >-
          README captures the decision matrix plus a recommendation, TODO.yaml references the selected path,
          docs/storefront_repo_prompt.md exists for the companion repo, and future tasks clearly state how
          purchases, auth, and analytics split across services.
      - id: online.server_authority_talo
        title: Server authoritative backend (Talo)
        priority: medium
        status: todo
        owner: unassigned
        problem: >-
          The sim currently trusts local state even though Talo already provides a Dockerized,
          Godot-ready backend (auth, leaderboards, analytics, remote config). We need to wire the
          official service into our project—without vendoring Talo's server code—so authoritative
          state, device/OAuth auth, and data visualization all flow through Talo instead of bespoke
          logic. Developers should run the upstream stack alongside this repo while `backend/`
          remains reserved for lightweight bridge scripts we author ourselves.
        entrypoints:
          - README.md (document architecture + auth expectations)
          - TODO.yaml (track backend milestones)
          - docs/integrations/talo.md (link to upstream Talo setup without vendoring files)
          - addons/talo_client/* (vendor plug-in configuration only)
          - autoload/game.gd (client networking hooks)
          - backend/ (future bridge scripts that proxy Talo without forking it)
        blockers: []
        subtasks:
          - description: Document how to clone/run the official Talo Docker stack from its upstream repo (outside of ours), link
              those steps inside `docs/integrations/talo.md`, and keep `backend/` empty except for our own bridge scripts.
          - description: Configure the vendor-supplied `addons/talo_client/` via project settings/resources (no code edits) so the
              sim can authenticate per-device, fallback to OAuth, and forward tokens to `autoload/game.gd`.
          - description: Map Talo features (leaderboards, remote config, analytics, presence) onto our gameplay loops, add any
              bridge scripts/config we need under `backend/`, and update README.md with trust boundaries/failure modes so eggs/
              inventory always sync through authoritative endpoints.
        definition_of_done: >-
          A Talo service owns the canonical game state, runs via the upstream repo/Docker instructions without any vendored
          files here, clients authenticate per-device or via OAuth through the configured plug-in, and documentation covers setup,
          bridge scripts inside `backend/`, and which Talo features back each gameplay surface.
      - id: online.storefront_egg_packs
        title: Storefront + egg pack purchases
        priority: medium
        status: done
        owner: unassigned
        problem: >-
          Egg bundles (and future SKUs) must be inventory-gated by the new multi-tenant commerce suite,
          but the Godot project still lacks storefront UI, client calls, and entitlement sync hooks.
          We need to consume offers from `commerce-hub-suite`, mint/consume bundles via REST, and keep
          Talo's authoritative inventory in sync after purchases.
        entrypoints:
          - scenes/ui/storefront/* (new UI panels + pack carousel)
          - autoload/game.gd (store commands + inventory refresh)
          - addons/talo_client/* (device/OAuth tokens forwarded to commerce suite)
          - addons/commerce_client/* (vendored Godot plug-in from `commerce-hub-suite`)
          - README.md / TODO.yaml (document offer tiers + costs + flows)
          - docs/storefront_repo_prompt.md (integration expectations)
        blockers:
          - core.egg_inventory_weighted_spawns
          - online.server_authority_talo
          - external.commerce_hub_suite_ready (plugin + APIs available from companion repo)
        subtasks:
          - description: Author a Godot storefront menu that lists offers from the commerce hub (egg bundle
              fixtures first), including pricing, drop rates, and limited-time badges with multi-tenant
              tenant/locale awareness.
          - description: Use the `commerce_client` add-on to call purchase endpoints, relay Talo auth tokens,
              and wait for entitlements so inventory can't desync or double-spend.
          - description: Sync UI and local inventory to the authoritative responses (commerce suite + Talo),
              surfacing success/failure state, receipts, and audit logs.
        definition_of_done: >-
          Players obtain egg bundles only through the storefront, purchases are validated by the commerce
          hub (with Talo receiving final entitlements), inventory updates atomically, and documentation
          explains SKU names, currencies, and logs for all tenants.
      - id: online.monetization_foundation
        title: Monetization + real-currency hooks
        priority: low
        status: todo
        owner: unassigned
        problem: >-
          The roadmap now calls for optional real-money purchases (egg packs, premium currencies, cosmetic
          bundles). There is no pricing model, payment provider plan, or entitlement flow, so we need a
          blueprint that keeps soft/hard currency in sync across the commerce hub and Talo.
        entrypoints:
          - README.md (monetization overview + compliance notes)
          - TODO.yaml (task tracking)
          - addons/commerce_client/* (receipt handling + entitlement hooks)
          - addons/talo_client/* (authoritative inventory sync)
          - docs/storefront_repo_prompt.md (adapter expectations + links)
          - ../commerce-hub-suite/apps/backend/payments/* (gateway adapters, payment stubs, once repo exists)
          - backend/talo/payments/* (Talo-side entitlements or storage sync if needed)
          - scenes/ui/storefront/* (toggle between soft/hard currency pricing)
          - autoload/game.gd (currency balances + receipt validation)
        blockers:
          - online.storefront_egg_packs
          - external.commerce_hub_suite_ready (commerce suite must expose payment adapters)
        subtasks:
          - description: Define SKU tables for soft-currency bundles, premium currency, and direct egg
              purchases, including price tiers for USD (or platform equivalents).
          - description: Select/pay mock gateways (Stripe test mode, Steam wallet, platform IAP) and
              describe how Talo will verify receipts before granting items.
          - description: Document refund/chargeback handling plus how real-money purchases convert into
              in-game egg inventory or currency balances.
        definition_of_done: >-
          Pricing tables, gateway integration plans, and entitlement validation steps are documented,
          Talo exposes placeholders/hooks for real-currency receipts, and the storefront can surface
          both soft- and hard-currency options even if final payment SDKs are stubbed.
