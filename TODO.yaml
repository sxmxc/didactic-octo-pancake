meta:
  version: 1
  last_updated: 2024-06-05
  notes: >-
    Structured backlog with priorities, blockers, and subtasks so agents can
    quickly gauge sequencing constraints.
areas:
  - id: core_mechanics
    title: Core mechanics
    tasks:
      - id: core.behavior_tree_action_expansion
        title: Behavior tree action expansion
        priority: medium
        status: todo
        owner: unassigned
        problem: >-
          The current creature behavior tree only contains a handful of basic actions (idle,
          sleep, eat, wander), so creatures never perform richer interactions like grooming,
          social play, nest maintenance, or curiosity-driven exploration.
        entrypoints:
          - ai/actions/* (existing behavior tree action scripts)
          - scenes/creature/Creature.gd (behavior tree assembly + blackboard state)
          - scenes/world.gd (world events that should trigger new actions)
        blockers: []
        subtasks:
          - description: Audit current actions to document coverage gaps (e.g., social, grooming,
              enrichment, nest upkeep) and capture required blackboard inputs/outputs.
          - description: Implement at least two new action scripts plus any supporting conditions
              or blackboard variables so behaviors can branch in more interesting ways.
          - description: Update Creature.gd to register the new actions/conditions and expose any
              tuning constants needed by designers.
          - description: Document action names, triggers, and side effects in README.md and ensure
              TODO.yaml references stay in sync once implemented.
        definition_of_done: >-
          Creatures regularly demonstrate the new actions in sandbox playtests, blackboard data is
          clearly defined, and documentation lists available actions plus how to extend them.
      - id: core.egg_inventory_weighted_spawns
        title: Egg inventory + weighted hatching
        priority: medium
        status: todo
        owner: unassigned
        problem: >-
          Eggs currently spawn randomly without player agency, but design now calls for
          pack-like drops (1/3/5 bundles) that players earn via daily/periodic rewards
          or purchase with soft currency, then consume to spawn new creatures using
          weighted RNG per egg tier.
        entrypoints:
          - autoload/data.gd (inventory + currency definitions)
          - autoload/game.gd (reward cadence + egg consumption flow)
          - scenes/world.gd (spawn loop integration)
          - scenes/ui/* (reward/pack purchase UX)
          - README.md / TODO.yaml (document pack naming + acquisition rules)
        blockers: []
        subtasks:
          - description: Introduce an egg inventory resource that tracks owned egg bundles
              and individual egg tokens with rarity weights.
          - description: Design "pack" alternatives (rename TBD) that grant 1, 3, or 5 eggs
              through daily login rewards, achievements, or in-game currency purchases.
          - description: Update spawn logic so creatures only hatch when an egg token is
              consumed, respecting weighted RNG tables per egg tier.
          - description: Surface reward cadence, inventory counts, and hatch odds in the UI
              so players understand acquisition and consumption flows.
        definition_of_done: >-
          Eggs no longer appear for free; players earn/stock egg tokens via login rewards or
          purchases, inventory counts gate spawns, and weighted RNG tables determine hatch
          results with clear documentation.
      - id: core.stat_training_loops
        title: Stat training loops
        priority: high
        status: todo
        owner: unassigned
        problem: >-
          Creatures can lose hunger/energy over time but have no way to raise
          strength, intelligence, or other stats.
        entrypoints:
          - scenes/world.gd (world tick + event wiring)
          - scenes/creature/creature.gd (stat container + behavior tree integration)
          - buildables/* (training stations)
          - autoload/eventbus.gd (signals)
          - resources/stats/creature_stats.gd
        blockers:
          - sim.training_payoff_model
        subtasks:
          - description: Author at least one Gym Pod/Study Desk buildable and register it in autoload/data.gd.
          - description: Extend idle AI so creatures can claim nearby training stations and emit "training" signals.
          - description: Increment stats during training sessions while draining hunger/energy on the world tick.
          - description: Broadcast progress through Eventbus so UI panels can reflect multiple concurrent trainings.
        definition_of_done: >-
          Stats visibly increase after training, UI reflects progress, and the system
          works for any number of creatures.
      - id: core.evolution_requirement_checks
        title: Evolution requirement checks
        priority: medium
        status: todo
        owner: unassigned
        problem: Species resources store requirement dictionaries, yet age-ups never evaluate them.
        entrypoints:
          - resources/creature/data/**/*.tres
          - scenes/creature/creature.gd::_age_up
          - resources/stats/creature_stats.gd
        blockers:
          - core.care_mistake_tracking
        subtasks:
          - description: Evaluate requirement dictionaries whenever a creature crosses an age threshold.
          - description: Select a valid teen/adult resource (support randomness or weighting) and swap sprites/stats.
          - description: Emit UI + notification signals detailing why a branch triggered.
        definition_of_done: >-
          Evolution outcomes reflect stat training and care history; requirements are
          easy to tweak per species.
      - id: core.care_mistake_tracking
        title: Care mistake tracking
        priority: medium
        status: todo
        owner: unassigned
        problem: CreatureStats exposes care_mistakes but nothing increments it.
        entrypoints:
          - scenes/creature/creature.gd
          - scenes/world.gd
          - autoload/eventbus.gd
        blockers: []
        subtasks:
          - description: Define neglect thresholds (starving hunger bar, sickness ignored, etc.).
          - description: Increment counters when thresholds are crossed and broadcast updates for UI/analytics.
          - description: Feed mistake values into evolution logic and document reset/decay rules.
        definition_of_done: >-
          Care mistakes rise under neglect, reset/decay rules are documented, and
          evolution branches consume the value.
      - id: core.trait_system
        title: Trait system
        priority: medium
        status: todo
        owner: unassigned
        problem: Creatures have no personality traits to differentiate behavior, yet design calls for positive/negative traits that can be inherited, learned, and evolve over time (e.g., "glutton" worsening or improving).
        entrypoints:
          - scenes/creature/creature.gd (trait container + lifecycle hooks)
          - resources/stats/creature_stats.gd (serialization + modifiers)
          - autoload/eventbus.gd (signals for trait changes)
          - README.md (document available traits and evolution rules)
          blockers: []
          subtasks:
            - description: Define a trait data model that supports positive/negative effects, tiers, and evolution paths.
            - description: Assign traits via weighted RNG at birth and expose hooks for scripted events to add/remove/upgrade traits.
            - description: Ensure trait effects influence hunger, energy, training, or behaviors and surface notifications when they change.
          definition_of_done: >-
            Creatures can spawn or learn traits, traits visibly impact simulation stats/behaviors, and documentation explains how traits evolve or flip alignment.
      - id: core.creature_types_and_nests
        title: Creature types + nest gating
        priority: medium
        status: todo
        owner: unassigned
        problem: >-
          Design now calls for land, flying, and water creatures with matching nest types, but the
          sim only exposes a single "BasicNest" buildable and creatures lack any elemental/type
          metadata, so nothing enforces habitat requirements.
        entrypoints:
          - resources/creature/species.gd (type metadata + serialization)
          - resources/creature/data/* (species resource definitions)
          - buildables/nests/* (new nest scenes + scripts per habitat)
          - autoload/data.gd (nest registries + build costs)
          - scenes/world.gd (spawning logic that assigns creatures to compatible nests)
          - README.md / TODO.yaml (document available types + nest rules)
        blockers: []
        subtasks:
          - description: Extend species resources with a `creature_type` enum (land, flying, water)
              and retrofit existing assets with the appropriate values.
          - description: Author distinct nest scenes/resources for water vs. land-capable creatures
              and register them in autoload/data.gd with clear build costs/requirements.
          - description: Update world spawning + nesting logic so water types can only occupy water
              nests while land and flying types share land nests, surfacing user feedback when no
              compatible nest exists.
          - description: Document the new type system, nest unlock rules, and cross-type behavior in
              README.md so future tasks can extend the taxonomy.
        definition_of_done: >-
          Every creature species declares a type, matching nests exist and are enforced at runtime,
          and documentation explains how habitats map to species plus how to add future types.
  - id: content_ux
    title: Content & UX
    tasks:
      - id: content.evolution_data_pass
        title: Evolution data pass
        priority: medium
        status: todo
        owner: unassigned
        problem: Only four baby species exist and one teen slot lacks a base form.
        entrypoints:
          - resources/creature/data/babies/*.tres
          - resources/creature/data/teens/*.tres
          - design docs
        blockers: []
        subtasks:
          - description: Flesh out evolution diagram nodes as .tres resources (names may be temporary).
          - description: Capture sprite references, requirement dictionaries, and metadata for each form.
          - description: Document relationships so future agents can implement them quickly.
        definition_of_done: >-
          Each teen/adult node in the diagram has a resource with documented
          requirements and owner sprites.
      - id: content.item_roster_audit
        title: Item roster audit
        priority: medium
        status: todo
        owner: unassigned
        problem: Starter buildables are debug conveniences and the long-term item list is undecided.
        entrypoints:
          - buildables/*
          - autoload/data.gd
          - design notes
        blockers: []
        subtasks:
          - description: Draft a proposed item progression (core habitat, specialty training gear, cosmetic clutter).
          - description: Note costs, unlock triggers, and desired effects for each tier.
          - description: Capture rationale inside README/TODO for early/mid/late-game availability.
        definition_of_done: >-
          README/TODO captures an ordered list of candidate items plus rationale for
          availability.
      - id: content.naming_and_theming
        title: Naming + theming review
        priority: low
        status: todo
        owner: unassigned
        problem: Species names are placeholders and may change with art direction.
        entrypoints:
          - resources/creature/data/**/*.tres
          - assets/design reference image
        blockers: []
        subtasks:
          - description: Propose naming conventions (e.g., elemental roots + suffix).
          - description: Outline how recolors or variants are labeled consistently.
          - description: Update design references if needed.
        definition_of_done: >-
          Documented naming guide plus a list of proposed replacements for existing
          species.
  - id: tooling
    title: Tooling
    tasks:
      - id: tooling.evolution_tree_asset_ingestion
        title: Evolution tree asset ingestion
        priority: medium
        status: todo
        owner: unassigned
        problem: The evolution-diagram image lives outside the repo.
        entrypoints:
          - assets/design/
          - README.md
        blockers: []
        subtasks:
          - description: Check the diagram into version control as both the editable source and exported PNG.
          - description: Reference the asset from README once available.
          - description: Document how to update/edit the source file.
        definition_of_done: >-
          Diagram sits in the repo, README links to it, and future contributors can
          edit the source.
  - id: simulation_balance
    title: Simulation balance
    tasks:
      - id: sim.hunger_energy_decay_tuning
        title: Hunger & energy decay tuning
        priority: high
        status: todo
        owner: unassigned
        problem: World tick fires every 10s and adjusts hunger/energy by fixed +/-1 (or +10 while sleeping), so creatures barely need attention.
        entrypoints:
          - scenes/world.gd
          - scenes/creature/creature.gd::_on_world_tick
          - resources/stats/creature_stats.gd
        blockers: []
        subtasks:
          - description: Decide the target number of hunger/energy interactions per in-game hour and derive decay curves.
          - description: Scale decay by life stage or species multipliers for difficulty pacing.
          - description: Revisit sleep recovery so rest gradually restores energy and optionally slows hunger gain.
        definition_of_done: >-
          Documented decay formula plus code changes that create a meaningful care
          cadence across all life stages.
      - id: sim.training_payoff_model
        title: Training payoff & upkeep model
        priority: high
        status: todo
        owner: unassigned
        problem: Strength/intelligence/happiness never change after hatching, so training buildables will have no systemic impact.
        entrypoints:
          - resources/stats/creature_stats.gd
          - buildables/*
          - scenes/creature/creature.gd
          - scenes/ui/*
        blockers:
          - sim.hunger_energy_decay_tuning
        subtasks:
          - description: Define how training modifies stats over time and how bonuses decay when neglected.
          - description: Link training sessions to hunger/energy drains or temporary buffs to introduce tradeoffs.
          - description: Surface progress in the UI and propagate stats into evolution or combat placeholders.
        definition_of_done: >-
          Training introduces clear tradeoffs (resource drain vs. stat growth), and
          documentation explains how to tune the reward curve and decay.
      - id: sim.save_load_and_idle_catchup
        title: Save/load & idle catch-up pipeline
        priority: highest
        status: todo
        owner: unassigned
        problem: Mobile builds rely on the OS keeping the process alive; once suspended or killed, progress is lost and decay ignores elapsed time.
        entrypoints:
          - autoload/data.gd
          - autoload/game.gd
          - autoload/eventbus.gd
          - scenes/world.gd
          - user://saves/ serialization helper (new)
        blockers: []
        subtasks:
          - description: Define a canonical save payload (creature stats, buildables, inventory, timers, RNG seeds) plus last_tick_epoch_ms.
          - description: Serialize on key actions and add a manual "Save & Sleep" flow for cautious players.
          - description: On boot, load payloads, compute elapsed time, and run bounded catch-up loops for decay/training.
          - description: Surface failures (corrupt save, version mismatch) with fallbacks and document how systems extend the payload.
        definition_of_done: >-
          Players can close the app, return hours later, and see creatures updated
          based on elapsed time without losing progress or corrupting saves.
  - id: online_services
    title: Online services & auth
    tasks:
      - id: online.storefront_architecture_eval
        title: Storefront architecture decision
        priority: high
        status: todo
        owner: unassigned
        problem: >-
          Talo supplies auth, analytics, and persistence, but it lacks a built-in storefront.
          We need a documented decision on whether to extend Talo, add a companion service, or
          replace it entirely before investing in purchase flows.
        entrypoints:
          - README.md (documented options + recommendation)
          - TODO.yaml (task breakdown once a direction is chosen)
          - backend/talo/* (evaluate extension points)
          - docs for proposed companion service (`backend/storefront/`)
        blockers: []
        subtasks:
          - description: Audit Talo server functions to confirm whether commerce logic can be embedded
              directly alongside the official backend.
          - description: Spike a proposal for a `backend/storefront/` companion that signs purchases and
              syncs inventory back into Talo via REST.
          - description: Outline risks, staffing needs, and migration criteria should we abandon Talo
              entirely for a bespoke backend.
        definition_of_done: >-
          README captures the decision matrix plus a recommendation, TODO.yaml references the selected path,
          and future tasks clearly state how purchases, auth, and analytics will split across services.
      - id: online.server_authority_talo
        title: Server authoritative backend (Talo)
        priority: medium
        status: todo
        owner: unassigned
        problem: >-
          The sim currently trusts local state even though Talo already provides a Dockerized,
          Godot-ready backend (auth, leaderboards, analytics, remote config). We need to wire the
          official service into our project so authoritative state, device/OAuth auth, and data
          visualization all flow through Talo instead of bespoke code.
        entrypoints:
          - README.md (document architecture + auth expectations)
          - TODO.yaml (track backend milestones)
          - backend/talo/docker-compose.yml (official stack + env samples)
          - addons/talo_client/* (Godot plug-in wiring)
          - autoload/game.gd (client networking hooks)
        blockers: []
        subtasks:
          - description: Vendor the upstream Talo Docker compose + env files into `backend/talo/`, document how to boot the
              stack locally, and confirm the dashboard is reachable.
          - description: Configure the Talo Godot add-on under `addons/talo_client/` so the sim can authenticate per-device,
              fallback to OAuth when necessary, and exchange inventory/save payloads with the backend.
          - description: Map Talo features (leaderboards, remote config, analytics, presence) onto our gameplay loops, update
              README.md with trust boundaries/failure modes, and ensure eggs/inventory sync through authoritative endpoints.
        definition_of_done: >-
          A Talo service owns the canonical game state, runs via Docker locally, clients authenticate
          per-device or via OAuth through the Godot plug-in, and documentation covers setup plus
          which Talo features back each gameplay surface.
      - id: online.storefront_egg_packs
        title: Storefront + egg pack purchases
        priority: medium
        status: todo
        owner: unassigned
        problem: >-
          Egg bundles are supposed to be inventory-gated, but there's no authoritative storefront
          that validates soft-currency spends or tracks which device bought a pack. We need a
          UI flow and Talo endpoints that mint/consume bundles, prevent dupes, and provide a
          foundation for daily deals or seasonal packs.
        entrypoints:
          - scenes/ui/storefront/* (new UI panels + pack carousel)
          - autoload/game.gd (store commands + inventory refresh)
          - addons/talo_client/* (authenticated purchase calls)
          - backend/storefront/* (companion purchase authority service)
          - backend/talo/functions/storefront/* (inventory sync hooks when Talo hosts logic directly)
          - README.md / TODO.yaml (document pack tiers + costs)
        blockers:
          - core.egg_inventory_weighted_spawns
          - online.server_authority_talo
          - online.storefront_architecture_eval
        subtasks:
          - description: Author a Godot storefront menu that lists available egg bundles (1/3/5) and
              surfaces costs, probabilities, and limited-time offers.
          - description: Implement Talo endpoints that debit soft currency, mint pack items, log
              transaction IDs, and respond with updated inventory counts.
          - description: Sync UI to authoritative inventory after each purchase, showing success/failure
              messages and persisting receipts for audits.
        definition_of_done: >-
          Players can only obtain egg bundles through the storefront, purchases are validated by Talo,
          inventory updates atomically, and documentation explains SKU names, currencies, and logging.
      - id: online.monetization_foundation
        title: Monetization + real-currency hooks
        priority: low
        status: todo
        owner: unassigned
        problem: >-
          The roadmap now calls for optional real-money purchases (buy egg packs directly or purchase
          premium currency). There is no pricing model, payment provider plan, or entitlement flow, so
          we need a blueprint that keeps soft and hard currency in sync with Talo.
        entrypoints:
          - README.md (monetization overview + compliance notes)
          - TODO.yaml (task tracking)
          - backend/storefront/payments/* (gateway integrations or mocks)
          - backend/talo/payments/* (Talo-side entitlements or storage sync)
          - scenes/ui/storefront/* (toggle between soft/hard currency pricing)
          - autoload/game.gd (currency balances + receipt validation)
        blockers:
          - online.storefront_egg_packs
          - online.storefront_architecture_eval
        subtasks:
          - description: Define SKU tables for soft-currency bundles, premium currency, and direct egg
              purchases, including price tiers for USD (or platform equivalents).
          - description: Select/pay mock gateways (Stripe test mode, Steam wallet, platform IAP) and
              describe how Talo will verify receipts before granting items.
          - description: Document refund/chargeback handling plus how real-money purchases convert into
              in-game egg inventory or currency balances.
        definition_of_done: >-
          Pricing tables, gateway integration plans, and entitlement validation steps are documented,
          Talo exposes placeholders/hooks for real-currency receipts, and the storefront can surface
          both soft- and hard-currency options even if final payment SDKs are stubbed.
